(("undefined"!==typeof self?self:this)["webpackJsonpkubewarden_1_6_10"]=("undefined"!==typeof self?self:this)["webpackJsonpkubewarden_1_6_10"]||[]).push([[2],{"00ce":function(e,t,r){"use strict";var a=function(){var e=this,t=e._self._c;return e.$fetchState.pending||e.refreshingCharts?t("Loading",{attrs:{mode:"relative"}}):t("div",[e.hasAvailability?e.showChecklist?t("TraceChecklist",{attrs:{"controller-app":e.controllerApp,"controller-chart":e.controllerChart,"tracing-configuration":e.tracingConfiguration,"jaeger-query-svc":e.jaegerQuerySvc,"open-tel-svc":e.openTelSvc,"outdated-telemetry-spec":e.outdatedTelemetrySpec,"unsupported-telemetry-spec":e.unsupportedTelemetrySpec,"incomplete-telemetry-spec":e.incompleteTelemetrySpec}}):!e.showChecklist&&e.emptyPolicies?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.tracing.noRelatedPolicies")}}):e.showTable?t("SortableTable",{attrs:{rows:e.filteredValidations,headers:e.TRACE_HEADERS,"table-actions":!1,"row-actions":!1,"key-field":"id","default-sort-by":"startTime","sub-expandable":!0,"sub-expand-column":!0,"sub-rows":!0,paging:!0,"rows-per-page":e.rowsPerPage},scopedSlots:e._u([{key:"col:mode",fn:function({row:r}){return[t("td",[t("BadgeState",{staticClass:"text-capitalize",attrs:{label:r.mode,color:e.modeColor(r.mode)}})],1)]}},{key:"col:name",fn:function({row:r}){return[t("td",{staticClass:"text-bold"},[e._v(" "+e._s(r.name)+" ")])]}},{key:"col:namespace",fn:function({row:r}){return[t("td",[e._v(" "+e._s(r.namespace?r.namespace:"-")+" ")])]}},{key:"col:startTime",fn:function({row:r}){return[t("td",[e._v(" "+e._s(e.formatTime(r.startTime))+" ")])]}},{key:"col:duration",fn:function({row:r}){return[t("td",[e._v(" "+e._s(e.duration(r.duration))+" ")])]}},{key:"sub-row",fn:function({row:r,fullColspan:a}){return[t("td",{staticClass:"sub-row",attrs:{colspan:a}},[t("div",{staticClass:"details"},[t("section",{staticClass:"col"},[t("div",{staticClass:"title"},[e._v("Response Message")]),t("span",{staticClass:"text-info text-capitalize"},[e._v(" "+e._s(r.responseMessage?r.responseMessage:"-")+" ")])]),t("section",{staticClass:"col"},[t("div",{staticClass:"title"},[e._v("Response Code")]),t("span",{staticClass:"text-info"},[e._v(" "+e._s(r.responseCode?r.responseCode:"-")+" ")])]),t("section",{staticClass:"col"},[t("div",{staticClass:"title"},[e._v("Mutated")]),t("span",{staticClass:"text-info"},[e._v(" "+e._s(r.mutated)+" ")])])])])]}}])}):t("Banner",{attrs:{color:"warning",label:e.t(e.emptyTracesLabel)}}):t("Banner",{staticClass:"mt-20 mb-20",attrs:{color:"error","data-testid":"kw-unavailability-banner",label:e.t("kubewarden.unavailability.banner",{type:e.t("kubewarden.unavailability.type.tracingDashboard")})}})],1)},i=[],o=r("9ce4"),n=r("330a"),s=r.n(n),l=r("d1f7"),c=r.n(l),d=r("050d"),u=r.n(d),p=r("be6d"),v=r.n(p),h=r("907c"),m=r("4ac6"),b=r("2359"),f=r("a8b9"),g=r("f17a"),y=r("6418"),k=r("15ca"),w=r("0fb1"),S=r("5191"),_=r("90cd"),C=r("5136"),T=r("ea28"),O=r("7d99"),A=r.n(O),R=r("37ef"),E=r.n(R),M=r("e4c5"),P=r.n(M);u.a.extend(P.a);const j=1e3,x=1e3*j,D=60*x,L=60*D,N=24*L,I=[{unit:"d",microseconds:N,ofPrevious:24},{unit:"h",microseconds:L,ofPrevious:60},{unit:"m",microseconds:D,ofPrevious:60},{unit:"s",microseconds:x,ofPrevious:1e3},{unit:"ms",microseconds:j,ofPrevious:1e3},{unit:"Î¼s",microseconds:1,ofPrevious:1e3}];function $(e){const[t,r]=A()(I,({microseconds:t},r)=>r<I.length-1&&t>e);if(1e3===t.ofPrevious)return`${E()(e/t.microseconds,2)}${t.unit}`;const a=Math.floor(e/t.microseconds),i=`${a}${t.unit}`,o=Math.round(e/r.microseconds%t.ofPrevious),n=`${o}${r.unit}`;return 0===o?i:`${i} ${n}`}var q=function(){var e=this,t=e._self._c;return t("div",[t("p",{staticClass:"checklist__description mb-20",attrs:{"data-testid":"kw-tracing-checklist-description"}},[e._v(" "+e._s(e.t("kubewarden.tracing.description"))+" ")]),t("div",{staticClass:"checklist__prereq mb-20"},[t("h2",[e._v(e._s(e.t("kubewarden.tracing.prerequisites.label")))]),t("p",[e._v(e._s(e.t("kubewarden.tracing.prerequisites.description")))])]),t("Banner",{attrs:{color:"warning",label:e.t("kubewarden.tracing.prerequisites.warning")}}),t("div",{staticClass:"checklist__container mt-20 mb-20"},[t("div",{staticClass:"checklist__step mt-20 mb-20",attrs:{"data-testid":"kw-tracing-checklist-step-open-tel"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.openTelSvc)}),t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.openTelemetry",{},!0),expression:"t('kubewarden.tracing.openTelemetry', {}, true)"}]})]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-tracing-checklist-step-jaeger"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.jaegerQuerySvc)}),t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.jaeger",{},!0),expression:"t('kubewarden.tracing.jaeger', {}, true)"}],attrs:{p:""}})]),t("div",[e.outdatedTelemetrySpec?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.tracing.prerequisites.outdated")}}):e._e(),e.unsupportedTelemetrySpec?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.tracing.prerequisites.unsupported")}}):e._e(),e.incompleteTelemetrySpec?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.tracing.prerequisites.incomplete")}}):e._e()],1),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-tracing-checklist-step-config"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.tracingEnabled)}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.config.label",{},!0),expression:"t('kubewarden.tracing.config.label', {}, true)"}]}),t("button",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.controllerLinkTooltip,expression:"controllerLinkTooltip"}],staticClass:"btn role-primary ml-10",attrs:{"data-testid":"kw-tracing-checklist-step-config-button",disabled:e.controllerLinkDisabled},on:{click:e.controllerAppRoute}},[e._v(" "+e._s(e.t("kubewarden.tracing.config.link"))+" ")])])])])],1)},B=[],V=r("da25"),G={props:{controllerApp:{type:Object,default:null},controllerChart:{type:Object,default:null},tracingConfiguration:{type:Object,default:null},jaegerQuerySvc:{type:Object,default:null},openTelSvc:{type:Object,default:null},outdatedTelemetrySpec:{type:Boolean,default:!1},unsupportedTelemetrySpec:{type:Boolean,default:!1},incompleteTelemetrySpec:{type:Boolean,default:!1}},components:{Banner:y["a"]},computed:{...Object(o["a"])(["currentCluster"]),controllerLinkTooltip(){return this.openTelSvc&&this.jaegerQuerySvc?this.controllerApp&&this.controllerChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Kubewarden Controller"},!0):this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites")},controllerLinkDisabled(){return!this.openTelSvc||!this.jaegerQuerySvc||!this.controllerApp||!this.controllerChart},tracingEnabled(){return this.tracingConfiguration?this.tracingConfiguration.enabled:null}},methods:{badgeIcon(e){return{"icon-dot-open":!e,"icon-checkmark":e,"text-success":e}},controllerAppRoute(){if(this.controllerApp){var e,t,r,a,i,o,n;const s=null===(e=this.controllerApp.spec)||void 0===e||null===(e=e.chart)||void 0===e?void 0:e.metadata,l={[V["g"]]:null===s||void 0===s||null===(t=s.annotations)||void 0===t?void 0:t[m["c"].NAMESPACE],[V["f"]]:null===s||void 0===s||null===(r=s.annotations)||void 0===r?void 0:r[m["c"].RELEASE_NAME],[V["q"]]:null===s||void 0===s||null===(a=s.annotations)||void 0===a?void 0:a["catalog.cattle.io/upstream-version"],[V["i"]]:null===s||void 0===s||null===(i=s.annotations)||void 0===i?void 0:i[m["c"].SOURCE_REPO_NAME],[V["j"]]:null===s||void 0===s||null===(o=s.annotations)||void 0===o?void 0:o[m["c"].SOURCE_REPO_TYPE],[V["d"]]:null===s||void 0===s?void 0:s.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:(null===(n=this.currentCluster)||void 0===n?void 0:n.id)||"_"},query:l})}}}},U=G,Y=(r("7d12"),r("d802")),z=Object(Y["a"])(U,q,B,!1,null,"f489d41c",null),H=z.exports;u.a.extend(v.a);var F={props:{resource:{type:String,default:()=>""},relatedPolicies:{type:Array,default:()=>[]},policy:{type:Object,default:()=>{}}},components:{BadgeState:g["a"],Banner:y["a"],Loading:k["a"],SortableTable:w["b"],TraceChecklist:H},mixins:[b["a"]],async fetch(){await this.fetchData()},data(){return{MODE_MAP:_["n"],TRACE_HEADERS:S["h"],OPERATION_MAP:_["o"],isAdminUser:!1,permissions:{policyServer:!1,app:!1,clusterRepo:!1,service:!1},specificValidations:null,outdatedTelemetrySpec:!1,unsupportedTelemetrySpec:!1,incompleteTelemetrySpec:!1}},watch:{async controllerApp(){this.controllerApp&&await this.controllerApp.fetchValues(!0)}},computed:{...Object(o["a"])(["currentCluster"]),...Object(o["a"])({charts:"catalog/charts",refreshingCharts:"kubewarden/refreshingCharts"}),allApps(){return this.$store.getters["cluster/all"](h["a"].APP)},allServices(){return this.$store.getters["cluster/all"](h["z"])},controllerApp(){var e;return null===(e=this.allApps)||void 0===e?void 0:e.find(e=>{var t;return(null===e||void 0===e||null===(t=e.spec)||void 0===t||null===(t=t.chart)||void 0===t||null===(t=t.metadata)||void 0===t?void 0:t.name)===_["h"].CONTROLLER})},controllerChart(){var e;return null===(e=this.charts)||void 0===e?void 0:e.find(e=>(null===e||void 0===e?void 0:e.chartName)===_["h"].CONTROLLER)},groupField(){return this.isPolicyServer?"policy_id":null},isPolicyServer(){return this.resource===_["f"].POLICY_SERVER},emptyPolicies(){return this.resource===_["f"].POLICY_SERVER?s()(this.relatedPolicies):s()(this.policy)},emptyTraces(){return s()(this.filteredValidations)},emptyTracesLabel(){return this.resource===_["f"].POLICY_SERVER?"kubewarden.tracing.noRelatedTraces":"kubewarden.tracing.noTraces"},hasAvailability(){return this.isAdminUser||Object.values(this.permissions).every(e=>e)},rowsPerPage(){return this.isPolicyServer?40:20},tracingConfiguration(){var e,t,r;if(null===(e=this.controllerApp)||void 0===e||!e.values)return null;const a=null===(t=this.controllerApp)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.chart)||void 0===t||null===(t=t.metadata)||void 0===t?void 0:t.version,i=null===(r=this.controllerApp)||void 0===r||null===(r=r.values)||void 0===r?void 0:r.telemetry;if(c.a.gte(a,"4.0.0-0")){var o,n;const e=void 0===(null===i||void 0===i?void 0:i.tracing)||"boolean"===typeof(null===i||void 0===i?void 0:i.tracing),t=!(null===i||void 0===i||null===(o=i.sidecar)||void 0===o||null===(o=o.tracing)||void 0===o||null===(o=o.jaeger)||void 0===o||!o.endpoint);return"custom"===(null===i||void 0===i?void 0:i.mode)?(this.unsupportedTelemetrySpec=!0,null):e?!0!==(null===i||void 0===i?void 0:i.tracing)||t?!0!==(null===i||void 0===i?void 0:i.tracing)?null:null===i||void 0===i||null===(n=i.sidecar)||void 0===n?void 0:n.tracing:(this.incompleteTelemetrySpec=!0,null):(this.outdatedTelemetrySpec=!0,null)}var s;return null===i||void 0===i||null===(s=i.tracing)||void 0===s?void 0:s.enabled},jaegerServices(){var e;return null===(e=this.allServices)||void 0===e?void 0:e.filter(e=>{var t;return"jaeger"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t["app.kubernetes.io/part-of"])})},jaegerQuerySvc(){return s()(this.jaegerServices)?null:this.jaegerServices.find(e=>{var t;const r=null===e||void 0===e||null===(t=e.spec)||void 0===t?void 0:t.ports;if(r.length)return r.find(e=>16685===e.port||16686===e.port)})},openTelemetryServices(){var e;return null===(e=this.allServices)||void 0===e?void 0:e.filter(e=>{var t;return"opentelemetry-operator"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t[m["h"].MANAGED_NAME])})},openTelSvc(){return s()(this.openTelemetryServices)?null:this.openTelemetryServices.find(e=>{var t;const r=null===e||void 0===e||null===(t=e.spec)||void 0===t?void 0:t.ports;if(r.length)return r.find(e=>8080===e.port)})},showChecklist(){return!this.openTelSvc||!this.jaegerQuerySvc||!this.tracingConfiguration},showTable(){return!this.emptyPolicies&&!this.showChecklist&&!this.emptyTraces},filteredValidations(){return s()(this.specificValidations)?[]:this.specificValidations.flatMap(e=>{var t;return(null===(t=this.currentCluster)||void 0===t?void 0:t.id)===e.cluster?e.traces:[]})}},methods:{async fetchData(){this.setAdminUser(),this.setPermissions(),await this.fetchCanListResources(),await this.handleJaegerTracing(),await this.fetchControllerAppValues()},setAdminUser(){this.isAdminUser=Object(T["a"])(this.$store.getters)},setPermissions(){const e={policyServer:{type:_["f"].POLICY_SERVER},app:{type:h["a"].APP},clusterRepo:{type:h["a"].CLUSTER_REPO},service:{type:h["z"]}};Object.entries(e).forEach(([e,t])=>{this.$store.getters["cluster/canList"](t)&&(this.permissions[e]=!0)})},async fetchCanListResources(){const e=[h["a"].APP,h["a"].CLUSTER_REPO,h["z"]],t=[];e.forEach(e=>{this.$store.getters["cluster/canList"](e)&&t.push(this.$fetchType(e))}),await Object(f["a"])(t)},async handleJaegerTracing(){if(this.jaegerQuerySvc){const e={store:this.$store,queryService:this.jaegerQuerySvc,resource:this.resource,relatedPolicies:null,policy:null};this.resource===_["f"].POLICY_SERVER?e.relatedPolicies=this.relatedPolicies:e.policy=this.policy,this.specificValidations=await Object(C["b"])(e)}},async fetchControllerAppValues(){this.controllerApp&&await this.controllerApp.fetchValues(!0)},modeColor(e){return this.MODE_MAP[e]},opColor(e){return this.OPERATION_MAP[e]},formatTime(e){return u()(e/1e3)},duration(e){return $(e)}}},Q=F,J=Object(Y["a"])(Q,a,i,!1,null,null,null);t["a"]=J.exports},"21b1":function(e,t,r){"use strict";r("c714")},"284d":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading"):t("div",[e.policyGauges?[t("div",{staticClass:"row"},[[t("div",{staticClass:"col span-6"},[t("h3",{attrs:{"data-testid":"kw-ps-detail-status-title"}},[e._v(" "+e._s(e.t("kubewarden.policyServer.policyGauge.byStatus"))+" ")]),t("div",{staticClass:"gauges mb-20"},e._l(e.policyGauges,(function(r,a){return t("CountGauge",{key:a,attrs:{total:e.relatedPoliciesTotal,useful:r.count||0,graphical:!1,"primary-color-var":"--sizzle-"+r.color,name:a}})})),1)])],e.emptyTraces?e._e():[t("div",{staticClass:"col span-6"},[t("h3",[e._v(" "+e._s(e.t("kubewarden.policyServer.policyGauge.traces"))+" ")]),t("div",{staticClass:"gauges mb-20"},e._l(e.tracesGauges,(function(r,a){return t("CountGauge",{key:a,attrs:{useful:r.count||0,total:e.traceGaugeTotals,graphical:!1,"primary-color-var":"--sizzle-"+r.color,name:a}})})),1)])]],2)]:e._e(),t("ResourceTabs",{attrs:{mode:e.mode},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[t("Tab",{attrs:{name:"related-policies",label:"Policies",weight:99},scopedSlots:e._u([{key:"default",fn:function(){return[t("ResourceTable",{attrs:{rows:e.relatedPolicies||[],headers:e.RELATED_HEADERS,groupable:!0,"group-by":e.groupPreference,"table-actions":!0,"data-testid":"kw-ps-detail-related-policies-list"},scopedSlots:e._u([{key:"col:operation",fn:function({row:r}){return[t("td",[t("BadgeState",{attrs:{"data-testid":`kw-ps-detail-${r.id}-state`,label:r.operation,color:e.color(r.operation)}})],1)]}}])})]},proxy:!0}])}),t("Tab",{staticClass:"relative",attrs:{name:"policy-tracing",label:"Tracing",weight:98}},[t("TraceTable",{attrs:{resource:e.resource,"related-policies":e.relatedPolicies}})],1),t("Tab",{staticClass:"relative",attrs:{name:"policy-metrics",label:"Metrics",weight:97},scopedSlots:e._u([{key:"default",fn:function(r){return[t("MetricsTab",{attrs:{resource:e.resource,"policy-server-obj":e.value,active:r.active}})]}}])})],1)],2)},i=[],o=r("9ce4"),n=r("330a"),s=r.n(n),l=r("da25"),c=r("a8b9"),d=r("305c"),u=r("5000"),p=r("74c2"),v=r("15ca"),h=r("c422"),m=r("126f"),b=r("38de"),f=r("5191"),g=r("3f46"),y=r("00ce"),k={name:"PolicyServer",components:{CountGauge:p["a"],Loading:v["a"],MetricsTab:g["a"],ResourceTabs:h["a"],ResourceTable:m["a"],Tab:b["a"],TraceTable:y["a"]},mixins:[d["a"]],props:{mode:{type:String,default:l["t"]},resource:{type:String,default:null},value:{type:Object,required:!0}},async fetch(){const e=await Object(c["a"])({relatedPolicies:this.value.allRelatedPolicies(),policyGauges:this.value.policyGauges()}),t=(e,t)=>{s()(t)||(this[e]=t)};t("relatedPolicies",e.relatedPolicies),t("policyGauges",e.policyGauges)},data(){return{RELATED_HEADERS:f["f"],policyGauges:null,relatedPolicies:null,reloadRequired:!1}},computed:{...Object(o["a"])(["currentCluster"]),...Object(o["a"])({policyTraces:"kubewarden/policyTraces"}),_group:Object(u["n"])(u["e"]),filteredTraces(){return s()(this.policyTraces)?null:this.policyTraces.filter(e=>{var t;if((null===(t=this.currentCluster)||void 0===t?void 0:t.id)===e.cluster)return e})},emptyTraces(){return s()(this.filteredTraces)},groupPreference(){const e="namespace"===this._group?"kind":null;return e},relatedPoliciesTotal(){return s()(this.relatedPolicies)?0:this.relatedPolicies.length},tracesGauges(){return this.emptyTraces?null:this.value.tracesGauges(this.filteredTraces)},traceGaugeTotals(){var e;return this.emptyTraces?0:null===(e=this.filteredTraces)||void 0===e?void 0:e.flatMap(e=>e.traces).length}},methods:{hasNamespaceSelector(e){return e.namespaceSelector}}},w=k,S=(r("2a13"),r("d802")),_=Object(S["a"])(w,a,i,!1,null,"a88dafa8",null);t["default"]=_.exports},"2a13":function(e,t,r){"use strict";r("b7b9")},"38eb":function(e,t,r){var a=r("5eaa");t=a(!1),t.push([e.i,".checklist__container[data-v-450512ba]{display:flex;justify-content:center;flex-direction:column;border:1px solid var(--border);padding:10px}.checklist__config[data-v-450512ba],.checklist__step[data-v-450512ba]{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}.checklist__step[data-v-450512ba]{min-height:40px}.conflicting-banner[data-v-450512ba]{display:flex;flex-direction:column}",""]),e.exports=t},"3f46":function(e,t,r){"use strict";var a=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading",{attrs:{mode:"relative"}}):t("div",[e.hasAvailability?e.showChecklist?t("MetricsChecklist",{attrs:{"cattle-dashboard-ns":e.cattleDashboardNs,"conflicting-grafana-dashboards":e.conflictingGrafanaDashboards,"controller-app":e.controllerApp,"controller-chart":e.controllerChart,"kubewarden-service-monitor":e.kubewardenServiceMonitor,"kubewarden-dashboards":e.kubewardenGrafanaDashboards,"metrics-configuration":e.metricsConfiguration,"monitoring-app":e.monitoringApp,"monitoring-chart":e.monitoringChart,"open-tel-svc":e.openTelSvc,"policy-obj":e.policyObj,"policy-server-obj":e.policyServerObj,"outdated-telemetry-spec":e.outdatedTelemetrySpec,"unsupported-telemetry-spec":e.unsupportedTelemetrySpec,"outdated-service-monitor":e.outdatedServiceMonitor},on:{updateServiceMonitors:e.updateServiceMonitors,updateServiceMonitorLabels:e.updateServiceMonitorLabels}}):[e.monitoringApp&&!e.metricsProxy?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.monitoring.warning.noProxy")}}):e._e(),e.metricsProxy&&e.active?t("DashboardMetrics",{attrs:{"data-testid":"kw-ps-metrics-dashboard","detail-url":e.metricsProxy,"summary-url":e.metricsProxy,vars:{policy_name:e.policyName},"graph-height":"825px"}}):e._e()]:t("Banner",{staticClass:"mt-20 mb-20",attrs:{color:"error","data-testid":"kw-unavailability-banner",label:e.t("kubewarden.unavailability.banner",{type:e.t("kubewarden.unavailability.type.metricsDashboard")})}})],2)},i=[],o=r("9ce4"),n=r("330a"),s=r.n(n),l=r("44db"),c=r.n(l),d=r("d1f7"),u=r.n(d),p=r("907c"),v=r("4ac6"),h=r("b45b"),m=r("f390"),b=r("a8b9"),f=r("2359"),g=r("c389"),y=r("15ca"),k=r("6418"),w=r("90cd"),S=r("ea28"),_=r("e9a3"),C=r("541d");async function T(e){const{store:t,type:r}=e;try{const e=await O(t);if(!s()(e)){const t=`/api/v1/namespaces/${e.metadata.namespace}/services`,a=`/http:${e.metadata.name}:80/proxy`,i=`/d/${r}?orgId=1&kiosk`;return t+a+i}}catch(a){Object(_["a"])({error:a,store:t,type:"warning"})}return null}async function O(e){try{return await e.dispatch("cluster/find",{type:p["z"],id:"cattle-monitoring-system/rancher-monitoring-grafana"},{root:!0})}catch(t){Object(_["a"])({error:t,store:e,type:"warning"})}}async function A(e){try{return await e.dispatch("cluster/findMatching",{type:p["b"],selector:"kubewarden/part-of=cattle-kubewarden-system"})}catch(t){Object(_["a"])({error:t,store:e,type:"warning"})}}async function R(e){const{store:t,monitoringApp:a,controllerApp:i}=e;if(a&&i){const e=Object.values(w["m"]);for(const s of e){var o;const e=await r("cb8a")(`./${s}.json`),l=s+".json",c=await A(t);if(c&&(null===c||void 0===c||null===(o=c.metadata)||void 0===o?void 0:o.name)===s)return;const d={[w["l"].DASHBOARD]:s,[w["l"].PART_OF]:i.metadata.namespace,[w["l"].APP]:"rancher-monitoring-grafana",[w["l"].GRAFANA_DASHBOARD]:"1","app.kubernetes.io/instance":a.metadata.name},u={[w["e"].NAME]:a.metadata.name,[w["e"].NAMESPACE]:a.metadata.namespace},v=await t.dispatch("cluster/create",{type:p["b"],metadata:{annotations:u,labels:d,name:s,namespace:"cattle-dashboards"},data:{[l]:JSON.stringify(e)}});try{await v.save()}catch(n){Object(_["a"])({error:n,store:t})}}}}var E=r("b23f");function M(e){const{policyObj:t,policyServerObj:r,allServiceMonitors:a}=e;if(!s()(a)){var i;const e=t?null===(i=t.spec)||void 0===i?void 0:i.policyServer:null===r||void 0===r?void 0:r.id;return null===a||void 0===a?void 0:a.find(t=>{var r;const a=null===t||void 0===t||null===(r=t.spec)||void 0===r||null===(r=r.selector)||void 0===r?void 0:r.matchLabels;return Object(E["a"])(a,e)})}}async function P(e){const{store:t,policyObj:r,controllerNs:a,serviceMonitor:i}=e;let{policyServerObj:o}=e;if(!i&&t.getters["cluster/schemaFor"](p["m"].SERVICEMONITOR)){var n,s,l,c;if(!o&&r&&t.getters["cluster/schemaFor"](w["f"].POLICY_SERVER)){var d;const e=await t.dispatch("cluster/find",{type:w["f"].POLICY_SERVER,id:null===(d=r.spec)||void 0===d?void 0:d.policyServer});e&&(o=e)}const e=r?null===(n=r.spec)||void 0===n?void 0:n.policyServer:null===(s=o)||void 0===s?void 0:s.id,i={"app.kubernetes.io/instance":"policy-server-"+e,"app.kubernetes.io/component":"policy-server","app.kubernetes.io/part-of":"kubewarden"};let h;var u;if(null!==(l=o)&&void 0!==l&&null!==(l=l.metadata)&&void 0!==l&&l.labels&&null!==(c=o)&&void 0!==c&&null!==(c=c.metadata)&&void 0!==c&&c.labels["app"])h={app:null===(u=o)||void 0===u||null===(u=u.metadata)||void 0===u?void 0:u.labels["app"]};else h=i;const m={apiVersion:"monitoring.coreos.com/v1",kind:"ServiceMonitor",type:p["m"].SERVICEMONITOR,metadata:{name:"kubewarden-"+e,namespace:a},spec:{endpoints:[{interval:"10s",port:"metrics"}],namespaceSelector:{matchNames:[a]},selector:{matchLabels:h}}},b=await t.dispatch("cluster/create",m);try{await b.save()}catch(v){Object(_["a"])({error:v,store:t})}}}function j(e,t){var r,a;if(!e||!t)return!1;const i=(null===(r=e.metadata)||void 0===r?void 0:r.labels)||{},o=(null===(a=t.spec)||void 0===a||null===(a=a.selector)||void 0===a?void 0:a.matchLabels)||{},n={"app.kubernetes.io/component":"policy-server","app.kubernetes.io/part-of":"kubewarden"},s=i["app.kubernetes.io/instance"]&&i["app.kubernetes.io/component"]&&i["app.kubernetes.io/part-of"];if(s){const e=o["app.kubernetes.io/instance"]&&o["app.kubernetes.io/component"]===n["app.kubernetes.io/component"]&&o["app.kubernetes.io/part-of"]===n["app.kubernetes.io/part-of"];return!e}return!1}var x=r("5136"),D=function(){var e=this,t=e._self._c;return t("div",{staticClass:"checklist__container"},[t("div",{staticClass:"checklist__prereq mb-20"},[t("h2",[e._v(e._s(e.t("kubewarden.monitoring.prerequisites.label")))]),t("p",[e._v(e._s(e.t("kubewarden.monitoring.prerequisites.description")))])]),t("Banner",{attrs:{color:"warning",label:e.t("kubewarden.monitoring.prerequisites.warning")}}),t("div",{staticClass:"mt-20 mb-20"},[t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-open-tel"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.openTelSvc),attrs:{"data-testid":"kw-otel-icon"}}),t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.openTelemetry",{},!0),expression:"t('kubewarden.tracing.openTelemetry', {}, true)"}]})]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-monitoring-app"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.monitoringApp),attrs:{"data-testid":"kw-monitoring-icon"}}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.monitoringApp.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.monitoringApp.label', {}, true)"}],attrs:{p:""}}),e.monitoringApp?e._e():t("button",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.monitoringLinkTooltip,expression:"monitoringLinkTooltip"}],staticClass:"btn role-primary ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-config-button",disabled:!e.monitoringChart},on:{click:function(t){return e.monitoringAppRoute()}}},[e._v(" "+e._s(e.monitoringChartLink)+" ")])])]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-service-monitor-map"}},[e.outdatedServiceMonitor?[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(!e.outdatedServiceMonitor),attrs:{"data-testid":"kw-sm-icon"}}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.serviceMonitor.upgrade.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.serviceMonitor.upgrade.label', {}, true)"}],attrs:{p:""}}),e.kubewardenServiceMonitor&&e.outdatedServiceMonitor?t("AsyncButton",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.updateServiceMonitorsTooltip,expression:"updateServiceMonitorsTooltip"}],staticClass:"ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-service-monitor-upgrade-button",mode:"serviceMonitorUpgrade",disabled:e.updateServiceMonitorButtonDisabled},on:{click:e.updateServiceMonitor}}):e._e()],1)]:[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.kubewardenServiceMonitor),attrs:{"data-testid":"kw-sm-icon"}}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.serviceMonitor.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.serviceMonitor.label', {}, true)"}],attrs:{p:""}}),e.kubewardenServiceMonitor?e._e():t("AsyncButton",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.serviceMonitorsTooltip,expression:"serviceMonitorsTooltip"}],staticClass:"ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-service-monitor-button",mode:"serviceMonitor",disabled:e.serviceMonitorButtonDisabled},on:{click:e.addServiceMonitor}})],1)]],2),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-config-map"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.hasKubewardenDashboards),attrs:{"data-testid":"kw-dashboard-icon"}}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.configMap.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.configMap.label', {}, true)"}],attrs:{p:""}}),e.hasKubewardenDashboards?e._e():t("AsyncButton",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.dashboardsTooltip,expression:"dashboardsTooltip"}],staticClass:"ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-config-map-button",mode:"grafanaDashboard",disabled:e.dashboardButtonDisabled},on:{click:e.addDashboards}})],1)]),e.showConflictingDashboardsBanner?t("Banner",{attrs:{color:"error"}},[t("div",{staticClass:"conflicting-banner",attrs:{"data-testid":"kw-monitoring-checklist-conflicting-banner"}},[t("p",[e._v(" "+e._s(e.t("kubewarden.monitoring.prerequisites.configMap.conflictingDashboardsBanner",{count:e.conflictingGrafanaDashboards.length},!0))+" ")]),e._l(e.conflictingGrafanaDashboards,(function(r){return t("n-link",{key:r.metadata.name,staticClass:"text-bold",attrs:{to:r.detailLocation}},[e._v(" "+e._s(r.metadata.name)+" ")])}))],2)]):e._e(),t("div",[e.outdatedTelemetrySpec?t("Banner",{attrs:{"data-testid":"kw-monitoring-checklist-outdated-telemetry",color:"error",label:e.t("kubewarden.monitoring.prerequisites.outdated")}}):e._e(),e.unsupportedTelemetrySpec?t("Banner",{attrs:{"data-testid":"kw-monitoring-checklist-unsupported-telemetry",color:"error",label:e.t("kubewarden.monitoring.prerequisites.unsupported")}}):e._e()],1),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-controller-config"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.metricsConfiguration),attrs:{"data-testid":"kw-metrics-config-icon"}}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.controllerConfig.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.controllerConfig.label', {}, true)"}],attrs:{p:""}}),e.metricsConfiguration?e._e():t("button",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.controllerLinkTooltip,expression:"controllerLinkTooltip"}],staticClass:"btn role-primary ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-config-button",disabled:e.controllerLinkDisabled},on:{click:function(t){return e.controllerAppRoute()}}},[e._v(" "+e._s(e.t("kubewarden.monitoring.prerequisites.controllerConfig.button"))+" ")])])])],1)],1)},L=[],N=r("da25"),I=r("d709"),$={props:{cattleDashboardNs:{type:Object,default:null},conflictingGrafanaDashboards:{type:Array,default:null},controllerApp:{type:Object,default:null},controllerChart:{type:Object,default:null},kubewardenServiceMonitor:{type:Object,default:null},kubewardenDashboards:{type:Array,default:null},metricsConfiguration:{type:Object,default:null},monitoringApp:{type:Object,default:null},monitoringChart:{type:Object,default:null},openTelSvc:{type:Object,default:null},policyObj:{type:Object,default:null},policyServerObj:{type:Object,default:null},outdatedTelemetrySpec:{type:Boolean,default:!1},unsupportedTelemetrySpec:{type:Boolean,default:!1},outdatedServiceMonitor:{type:Boolean,default:!1}},components:{AsyncButton:I["b"],Banner:k["a"]},computed:{...Object(o["a"])(["currentCluster"]),...Object(o["a"])({t:"i18n/t"}),controllerLinkDisabled(){return!this.openTelSvc||!this.monitoringApp||!this.hasKubewardenDashboards||!this.controllerChart||!this.controllerApp},controllerLinkTooltip(){return this.controllerLinkDisabled?this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites"):this.controllerChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Kubewarden Controller"},!0)},dashboardsTooltip(){return this.monitoringApp?this.monitoringApp&&s()(this.cattleDashboardNs)?this.t("kubewarden.monitoring.prerequisites.tooltips.nsNotFound"):null:this.t("kubewarden.monitoring.prerequisites.tooltips.appNotInstalled",{app:"Rancher Monitoring"},!0)},dashboardButtonDisabled(){return!this.monitoringApp||s()(this.cattleDashboardNs)||!this.hasKubewardenDashboards&&!!this.conflictingGrafanaDashboards.length},hasKubewardenDashboards(){return!s()(this.kubewardenDashboards)},monitoringChartLink(){return this.monitoringApp?this.t("kubewarden.monitoring.prerequisites.monitoringApp.edit"):this.t("kubewarden.monitoring.prerequisites.monitoringApp.install")},monitoringLinkTooltip(){return this.monitoringChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Rancher Monitoring"},!0)},serviceMonitorButtonDisabled(){return!this.controllerApp||!this.monitoringApp},serviceMonitorsTooltip(){return this.monitoringApp?!this.kubewardenServiceMonitor&&this.controllerApp?this.t("kubewarden.monitoring.prerequisites.tooltips.monitorsNotFound",{namespace:null===(e=this.controllerApp.metadata)||void 0===e?void 0:e.namespace},!0):null:this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites");var e},updateServiceMonitorsTooltip(){return this.t("kubewarden.monitoring.prerequisites.tooltips.updateServiceMonitor",{},!0)},updateServiceMonitorButtonDisabled(){return!this.kubewardenServiceMonitor||!this.monitoringApp},showConflictingDashboardsBanner(){return!this.hasKubewardenDashboards&&!s()(this.conflictingGrafanaDashboards)}},methods:{async addDashboards(e){try{await R({store:this.$store,monitoringApp:this.monitoringApp,controllerApp:this.controllerApp}),e(!0)}catch(t){Object(_["a"])({error:t,store:this.$store}),e(!1)}},async addServiceMonitor(e){try{var t;await P({store:this.$store,policyObj:this.policyObj,policyServerObj:this.policyServerObj,controllerNs:null===(t=this.controllerApp)||void 0===t||null===(t=t.metadata)||void 0===t?void 0:t.namespace,serviceMonitor:this.kubewardenServiceMonitor}),this.$emit("updateServiceMonitors"),e(!0)}catch(r){Object(_["a"])({error:r,store:this.$store}),e(!1)}},async updateServiceMonitor(e){if(this.kubewardenServiceMonitor)try{var t,r;const a=this.kubewardenServiceMonitor,i=(null===(t=this.policyServerObj)||void 0===t||null===(t=t.metadata)||void 0===t?void 0:t.name)||(null===(r=this.policyObj)||void 0===r||null===(r=r.spec)||void 0===r?void 0:r.policyServer);a.spec.selector.matchLabels={"app.kubernetes.io/instance":"policy-server-"+i,"app.kubernetes.io/component":"policy-server","app.kubernetes.io/part-of":"kubewarden"},await a.save(),this.$emit("updateServiceMonitorLabels"),e(!0)}catch(a){Object(_["a"])({error:a,store:this.$store}),e(!1)}else e(!1)},badgeIcon(e){if(Array.isArray(e)){const t=s()(e);return{"icon-dot-open":t,"icon-checkmark":!t,"text-success":!t}}return{"icon-dot-open":!e,"icon-checkmark":e,"text-success":e}},monitoringAppRoute(){if(!this.monitoringApp&&this.monitoringChart&&this.monitoringChart.goToInstall(),this.monitoringApp){var e,t,r,a,i,o,n;const s={[N["g"]]:null===(e=this.monitoringApp.metadata)||void 0===e?void 0:e.namespace,[N["f"]]:null===(t=this.monitoringApp.metadata)||void 0===t?void 0:t.name,[N["q"]]:null===(r=this.monitoringApp.spec)||void 0===r||null===(r=r.chart)||void 0===r||null===(r=r.metadata)||void 0===r?void 0:r.version,[N["i"]]:null===(a=this.monitoringApp.spec)||void 0===a||null===(a=a.chart)||void 0===a||null===(a=a.metadata)||void 0===a||null===(a=a.annotations)||void 0===a?void 0:a[v["c"].SOURCE_REPO_NAME],[N["j"]]:null===(i=this.monitoringApp.spec)||void 0===i||null===(i=i.chart)||void 0===i||null===(i=i.metadata)||void 0===i||null===(i=i.annotations)||void 0===i?void 0:i[v["c"].SOURCE_REPO_TYPE],[N["d"]]:null===(o=this.monitoringApp.spec)||void 0===o||null===(o=o.chart)||void 0===o||null===(o=o.metadata)||void 0===o?void 0:o.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:(null===(n=this.currentCluster)||void 0===n?void 0:n.id)||"_"},query:s})}},controllerAppRoute(){if(this.controllerApp){var e,t,r,a,i,o,n;const s=null===(e=this.controllerApp.spec)||void 0===e||null===(e=e.chart)||void 0===e?void 0:e.metadata,l={[N["g"]]:null===s||void 0===s||null===(t=s.annotations)||void 0===t?void 0:t[v["c"].NAMESPACE],[N["f"]]:null===s||void 0===s||null===(r=s.annotations)||void 0===r?void 0:r[v["c"].RELEASE_NAME],[N["q"]]:null===s||void 0===s||null===(a=s.annotations)||void 0===a?void 0:a["catalog.cattle.io/upstream-version"],[N["i"]]:null===s||void 0===s||null===(i=s.annotations)||void 0===i?void 0:i[v["c"].SOURCE_REPO_NAME],[N["j"]]:null===s||void 0===s||null===(o=s.annotations)||void 0===o?void 0:o[v["c"].SOURCE_REPO_TYPE],[N["d"]]:null===s||void 0===s?void 0:s.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:(null===(n=this.currentCluster)||void 0===n?void 0:n.id)||"_"},query:l})}}}},q=$,B=(r("21b1"),r("d802")),V=Object(B["a"])(q,D,L,!1,null,"450512ba",null),G=V.exports,U={props:{active:{type:Boolean,default:null},resource:{type:String,default:null},policyObj:{type:Object,default:null},policyServerObj:{type:Object,default:null}},components:{Banner:k["a"],DashboardMetrics:g["a"],Loading:y["a"],MetricsChecklist:G},mixins:[f["a"]],async fetch(){await this.fetchData()},data(){const e=this.resource===w["f"].POLICY_SERVER?w["m"].POLICY_SERVER:w["m"].POLICY;return{METRICS_TYPE:e,isAdminUser:!1,permissions:{policyServer:!1,app:!1,clusterRepo:!1,configMap:!1,serviceMonitor:!1,namespace:!1,service:!1},[p["a"].APP]:null,[p["a"].CLUSTER_REPO]:null,[p["b"]]:null,[p["m"].SERVICEMONITOR]:null,[p["z"]]:null,metricsProxy:null,metricsService:null,debouncedRefreshCharts:null,outdatedTelemetrySpec:!1,unsupportedTelemetrySpec:!1}},watch:{async grafanaService(){var e;this.metricsProxy||(this.metricsProxy=await T({store:this.$store,type:this.METRICS_TYPE}),this.metricsProxy&&(this.metricsService=await Object(h["b"])("v2",this.$store,null===(e=this.currentCluster)||void 0===e?void 0:e.id,this.metricsProxy)))},async controllerApp(){this.controllerApp&&await this.controllerApp.fetchValues(!0)}},computed:{...Object(o["a"])(["currentCluster","productId"]),...Object(o["a"])({charts:"catalog/charts"}),...Object(m["b"])(),policyName(){return Object(x["a"])(this.policyObj)},allApps(){return this.$store.getters["cluster/all"](p["a"].APP)},allRepos(){return this.$store.getters["cluster/all"](p["a"].CLUSTER_REPO)},allConfigMaps(){return this.$store.getters["cluster/all"](p["b"])},allNamespaces(){return this.$store.getters["cluster/all"](p["n"])},allPolicyServers(){return this.$store.getters["cluster/all"](w["f"].POLICY_SERVER)},allServiceMonitors(){return this.$store.getters["cluster/all"](p["m"].SERVICEMONITOR)},allServices(){return this.$store.getters["cluster/all"](p["z"])},cattleDashboardNs(){var e;return null===(e=this.allNamespaces)||void 0===e?void 0:e.find(e=>{var t;return"cattle-dashboards"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.name)})},conflictingGrafanaDashboards(){var e;return null===(e=this.allConfigMaps)||void 0===e?void 0:e.filter(e=>{var t;const r=null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.name;if(r)return r===w["m"].POLICY_SERVER||r===w["m"].POLICY})},controllerApp(){var e;return null===(e=this.allApps)||void 0===e?void 0:e.find(e=>{var t;return(null===e||void 0===e||null===(t=e.spec)||void 0===t||null===(t=t.chart)||void 0===t||null===(t=t.metadata)||void 0===t?void 0:t.name)===w["h"].CONTROLLER})},controllerChart(){var e;return null===(e=this.charts)||void 0===e?void 0:e.find(e=>e.chartName===w["h"].CONTROLLER)},grafanaService(){var e;const t=null===(e=this.allServices)||void 0===e?void 0:e.filter(e=>{var t;return"rancher-monitoring"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t["app.kubernetes.io/instance"])});return null===t||void 0===t?void 0:t.find(e=>{var t;return"grafana"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t["app.kubernetes.io/name"])})},hasAvailability(){return this.isAdminUser||Object.values(this.permissions).every(e=>e)},kubewardenGrafanaDashboards(){var e;return null===(e=this.allConfigMaps)||void 0===e?void 0:e.filter(e=>{var t;return null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t[w["l"].DASHBOARD]})},kubewardenServiceMonitor(){var e;return M({policyObj:this.policyObj,policyServerObj:this.policyServerObj,controllerNs:null===(e=this.controllerApp)||void 0===e||null===(e=e.metadata)||void 0===e?void 0:e.namespace,allServiceMonitors:this.allServiceMonitors})},metricsConfiguration(){var e,t,r;if(null===(e=this.controllerApp)||void 0===e||!e.values)return null;const a=null===(t=this.controllerApp)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.chart)||void 0===t||null===(t=t.metadata)||void 0===t?void 0:t.version,i=null===(r=this.controllerApp)||void 0===r||null===(r=r.values)||void 0===r?void 0:r.telemetry;if(u.a.gte(a,"4.0.0-0")){const e=void 0===(null===i||void 0===i?void 0:i.metrics)||"boolean"===typeof(null===i||void 0===i?void 0:i.metrics);return"custom"===(null===i||void 0===i?void 0:i.mode)?(this.unsupportedTelemetrySpec=!0,null):e?!0!==(null===i||void 0===i?void 0:i.metrics)?null:null===i||void 0===i?void 0:i.metrics:(this.outdatedTelemetrySpec=!0,null)}var o;return null===i||void 0===i||null===(o=i.metrics)||void 0===o?void 0:o.enabled},monitoringApp(){var e;return null===(e=this.allApps)||void 0===e?void 0:e.find(e=>{var t;return"rancher-monitoring"===(null===e||void 0===e||null===(t=e.spec)||void 0===t||null===(t=t.chart)||void 0===t||null===(t=t.metadata)||void 0===t?void 0:t.name)})},monitoringChart(){var e;return null===(e=this.charts)||void 0===e?void 0:e.find(e=>"rancher-monitoring"===e.chartName)},outdatedServiceMonitor(){const e=this.kubewardenServiceMonitor,t=this.policyServerObj;return!(!e||!t)&&j(t,e)},openTelemetryServices(){return this.allServices?this.allServices.filter(e=>{var t;return"opentelemetry-operator"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t[v["h"].MANAGED_NAME])}):null},openTelSvc(){return s()(this.openTelemetryServices)?null:this.openTelemetryServices.find(e=>{var t;const r=null===e||void 0===e||null===(t=e.spec)||void 0===t?void 0:t.ports;if(r.length)return r.find(e=>8080===e.port)})},policyServerSvcs(){if(!s()(this.allPolicyServers)){const t=this.allPolicyServers.map(e=>{var t;return null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.name}),r=[];for(const a of t){var e;r.push(null===(e=this.allServices)||void 0===e?void 0:e.find(e=>{var t;return(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t.app)==="kubewarden-policy-server-"+a}))}return r}return null},showChecklist(){const e=[!this.openTelSvc,!this.monitoringApp,!this.kubewardenServiceMonitor,!this.metricsConfiguration,!this.kubewardenGrafanaDashboards||s()(this.kubewardenGrafanaDashboards),this.outdatedServiceMonitor];return e.some(Boolean)}},methods:{async fetchData(){this.setAdminUser(),this.setPermissions(),this.initDebouncedRefreshCharts(),await this.fetchResourcesData(),this.refreshChartsIfNeeded(),await this.handleGrafanaDashboard(),await this.fetchControllerAppValues()},setAdminUser(){this.isAdminUser=Object(S["a"])(this.$store.getters)},setPermissions(){const e={policyServer:{type:w["f"].POLICY_SERVER},app:{type:p["a"].APP},clusterRepo:{type:p["a"].CLUSTER_REPO},configMap:{type:p["b"]},serviceMonitor:{type:p["m"].SERVICEMONITOR},namespace:{type:p["n"]},service:{type:p["z"]}};Object.entries(e).forEach(([e,t])=>{this.$store.getters["cluster/canList"](t)&&(this.permissions[e]=!0)})},initDebouncedRefreshCharts(){this.debouncedRefreshCharts=c()((e=!1)=>{Object(C["d"])({store:this.$store,chartName:"rancher-monitoring",init:e})},500)},async fetchResourcesData(){const e=[{name:p["a"].APP,property:this.allApps},{name:p["a"].CLUSTER_REPO,property:this.allRepos},{name:p["b"],property:this.allConfigMaps},{name:w["f"].POLICY_SERVER,property:this.allPolicyServers},{name:p["m"].SERVICEMONITOR,property:this.allServiceMonitors},{name:p["n"],property:this.allNamespaces},{name:p["z"],property:this.allServices}],t=e.reduce((e,t)=>(s()(t.property)&&this.$store.getters["cluster/canList"](t.name)&&e.push(this.$fetchType(t.name)),e),[]);await Object(b["a"])(t)},refreshChartsIfNeeded(){this.showChecklist&&!this.monitoringChart&&this.debouncedRefreshCharts(!0)},async handleGrafanaDashboard(){if(this.monitoringStatus.installed)try{var e;if(this.metricsProxy=await T({store:this.$store,type:this.METRICS_TYPE}),this.metricsProxy)this.metricsService=await Object(h["b"])("v2",this.$store,null===(e=this.currentCluster)||void 0===e?void 0:e.id,this.metricsProxy)}catch(t){Object(_["a"])({error:{_statusText:"Error",message:"Error fetching Grafana Service: "+t},store:this.$store})}},async fetchControllerAppValues(){this.controllerApp&&await this.controllerApp.fetchValues(!0)},async updateServiceMonitors(){await this.$fetchType(p["m"].SERVICEMONITOR)},async updateServiceMonitorLabels(){await this.$fetchType(p["m"].SERVICEMONITOR),this.outdatedServiceMonitor=!1},handleMetricsChecklist(e,t){this[e]=t}}},Y=U,z=Object(B["a"])(Y,a,i,!1,null,null,null);t["a"]=z.exports},5136:function(e,t,r){"use strict";r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return c}));var a=r("330a"),i=r.n(a),o=r("90cd");function n(e,t){const r=null===e||void 0===e?void 0:e.links["view"],a=r.lastIndexOf("/");return s(r.slice(0,a),"http",null===e||void 0===e?void 0:e.metadata.name,t)}function s(e,t,r,a,i){const o=(t?encodeURIComponent(t)+":":"")+encodeURIComponent(r)+(a?":"+encodeURIComponent(a):""),n="/"+(i||"").replace(/^\/+/g,""),s=e.replace(/\/+$/g,""),l=`${s}/${o}/proxy${n}`;return l}async function l(e){const{store:t,queryService:r,resource:a,relatedPolicies:o,policy:s,time:l}=e;try{const e=n(r,16686),c=[];if(i()(o)){if(!s)throw new Error("Policy is undefined");c.push(d(t,e,s,l))}else null===o||void 0===o||o.forEach(r=>{const a=d(t,e,r,l);a&&c.push(a)});let p=await Promise.all(c);return p=p.flatMap(e=>null===e||void 0===e?void 0:e.data),u(t,p,a,o,s)}catch(c){console.warn("Error fetching Jaeger traces: "+c)}return null}function c(e){var t,r,a;let i=null;switch(null===e||void 0===e?void 0:e.kind){case"ClusterAdmissionPolicy":i="clusterwide-"+(null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.name);break;case"AdmissionPolicy":i=`namespaced-${null===e||void 0===e||null===(r=e.metadata)||void 0===r?void 0:r.namespace}-${null===e||void 0===e||null===(a=e.metadata)||void 0===a?void 0:a.name}`;break;default:break}return i}function d(e,t,r,a){let i=null;const o=c(r),n=a||"2d",s=`lookback=${n}&tags={"policy_id"%3A"${o}"}`;i="api/traces?service=kubewarden-policy-server&operation=validation&"+s;const l=""+(t+i);return e.dispatch("cluster/request",{url:l})}function u(e,t,r,a,n){const s=e.getters["currentCluster"],l=[];function d(r){const a=c(r);return t.reduce((t,o)=>{var n;let l={};const c=o.spans.find(e=>"validation"===e.operationName),d=null===c||void 0===c||null===(n=c.tags)||void 0===n?void 0:n.find(e=>"policy_id"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e?void 0:e.value)===a);if(d){const e=p(c.tags);l={id:o.traceID,allowed:e.allowed,mode:r.spec.mode,name:e.name,operation:e.operation,kind:e.kind,namespace:e.namespace||null,startTime:c.startTime,duration:c.duration,responseMessage:e.response_message,responseCode:e.response_code,mutated:e.mutated}}return i()(l)||(t.push(l),e.dispatch("kubewarden/updatePolicyTraces",{policyName:r.metadata.name,cluster:null===s||void 0===s?void 0:s.id,updatedTrace:l})),t},[])}if(r===o["f"].POLICY_SERVER)for(const o of a){const e=d(o);i()(e)||l.push({policyName:o.metadata.name,cluster:null===s||void 0===s?void 0:s.id,traces:e})}else{const e=d(n);i()(e)||l.push({policyName:n.metadata.name,cluster:null===s||void 0===s?void 0:s.id,traces:e})}return l}function p(e){const t={};for(const r of e)switch(r.type){case"string":t[r.key]=r.value;break;case"int64":t[r.key]=parseInt(r.value,10);break;case"float64":t[r.key]=parseFloat(r.value);break;case"bool":t[r.key]="true"===r.value;break;default:t[r.key]=r.value}return t}},5523:function(e,t,r){var a=r("5eaa");t=a(!1),t.push([e.i,".relative[data-v-a88dafa8]{position:relative}.policy__mode[data-v-a88dafa8]{display:flex;align-items:center}.policy__mode i[data-v-a88dafa8]{margin-left:5px;font-size:22px;color:var(--warning)}.gauges[data-v-a88dafa8],.gaugesContainer[data-v-a88dafa8]{display:flex}.gauges[data-v-a88dafa8]{justify-content:space-around;flex-wrap:wrap;justify-content:left}.gauges .count-gauge[data-v-a88dafa8]{width:46%;margin-bottom:10px;flex:initial}.gauges>*[data-v-a88dafa8]{flex:1;margin-right:1.75%}",""]),e.exports=t},"55e7":function(e,t,r){var a=r("749a");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=r("0ed3").default;i("5f488408",a,!0,{sourceMap:!1,shadowMode:!1})},"733f":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("PolicyDetail",{attrs:{value:e.value,mode:e.mode,resource:e.resource}})},i=[],o=r("da25"),n=r("80db"),s={name:"AdmissionPolicy",props:{mode:{type:String,default:o["t"]},resource:{type:String,default:null},value:{type:Object,required:!0}},components:{PolicyDetail:n["a"]}},l=s,c=r("d802"),d=Object(c["a"])(l,a,i,!1,null,null,null);t["default"]=d.exports},"749a":function(e,t,r){var a=r("5eaa");t=a(!1),t.push([e.i,".checklist__container[data-v-f489d41c]{display:flex;justify-content:center;flex-direction:column;border:1px solid var(--border);padding:10px}.checklist__config[data-v-f489d41c],.checklist__step[data-v-f489d41c]{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}.checklist__step[data-v-f489d41c]{min-height:40px}",""]),e.exports=t},"7d12":function(e,t,r){"use strict";r("55e7")},"80db":function(e,t,r){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"mb-20"},[t("h3",[e._v(e._s(e.t("namespace.resources")))])]),t("ResourceTabs",{attrs:{"data-testid":"kw-policy-detail-tabs",mode:e.mode,"need-related":e.hasRelationships},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[e.policyReadme?t("Tab",{attrs:{name:"policy-readme",label:"Readme",weight:99}},[t("Markdown",{attrs:{"data-testid":"kw-policy-detail-readme"},model:{value:e.policyReadme,callback:function(t){e.policyReadme=t},expression:"policyReadme"}})],1):e._e(),e.hasRules?t("Tab",{attrs:{name:"policy-rules",label:"Rules",weight:98}},[t("RulesTable",{attrs:{rows:e.rulesRows,"data-testid":"kw-policy-detail-rules-table"}})],1):e._e(),t("Tab",{attrs:{name:"policy-tracing",label:"Tracing",weight:97}},[t("TraceTable",{attrs:{resource:e.resource,policy:e.value,"data-testid":"kw-policy-detail-trace-table"}})],1),t("Tab",{attrs:{name:"policy-metrics",label:"Metrics",weight:96},scopedSlots:e._u([{key:"default",fn:function(r){return[t("MetricsTab",{attrs:{resource:e.resource,"policy-obj":e.value,active:r.active}})]}}])})],1)],1)},i=[],o=r("9ce4"),n=r("330a"),s=r.n(n),l=r("da25"),c=r("f390"),d=r("305c"),u=r("56dc"),p=r("c422"),v=r("38de"),h=r("90cd"),m=r("3f46"),b=function(){var e=this,t=e._self._c;return t("div",[e.rows.length>0?t("SortableTable",{attrs:{"data-testid":"kw-policy-rules-sortable-table",rows:e.rows,headers:e.RULE_HEADERS,"table-actions":!1,"row-actions":!1,"key-field":"traceID","default-sort-by":"startTime"},scopedSlots:e._u([{key:"col:apiGroup",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(r.apiGroups||"-"))])])]}},{key:"col:apiVersion",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(r.apiVersions||"-"))])])]}},{key:"col:operations",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(e.joinColumn(r.operations)))])])]}},{key:"col:resources",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(e.joinColumn(r.resources)))])])]}}],null,!1,1857136105)}):t("div",[t("Banner",{staticClass:"type-banner mb-20 mt-0",attrs:{color:"warning",label:e.t("kubewarden.policies.noRules")}})],1)],1)},f=[],g=r("6418"),y=r("0fb1"),k=r("5191"),w={props:{rows:{type:Array,default:()=>[]}},components:{Banner:g["a"],SortableTable:y["b"]},data(){return{RULE_HEADERS:k["g"]}},methods:{joinColumn(e){return(null===e||void 0===e?void 0:e.join(", "))||""}}},S=w,_=r("d802"),C=Object(_["a"])(S,b,f,!1,null,null,null),T=C.exports,O=r("00ce"),A={name:"PolicyDetail",components:{Markdown:u["a"],MetricsTab:m["a"],ResourceTabs:p["a"],RulesTable:T,Tab:v["a"],TraceTable:O["a"]},mixins:[d["a"]],props:{mode:{type:String,default:l["t"]},resource:{type:String,default:null},value:{type:Object,default:()=>{}}},async mounted(){var e;if(null!==(e=this.value)&&void 0!==e&&null!==(e=e.metadata)&&void 0!==e&&null!==(e=e.annotations)&&void 0!==e&&e[h["b"]])try{const e=await this.value.artifactHubPackageVersion();e&&!e.error&&e.readme&&(this.policyReadme=JSON.parse(JSON.stringify(e.readme)))}catch(t){console.warn("Unable to fetch artifacthub package: "+t)}},data(){return{policyReadme:null}},computed:{...Object(o["a"])(["currentCluster"]),...Object(c["b"])(),dashboardVars(){var e;return{policy_name:"clusterwide-"+(null===(e=this.value)||void 0===e?void 0:e.id)}},hasRelationships(){var e;return!(null===(e=this.value)||void 0===e||null===(e=e.metadata)||void 0===e||!e.relationships)},hasRules(){var e;return!s()(null===(e=this.rulesRows)||void 0===e?void 0:e[0])},rulesRows(){var e;return null===(e=this.value)||void 0===e||null===(e=e.spec)||void 0===e?void 0:e.rules}}},R=A,E=Object(_["a"])(R,a,i,!1,null,null,null);t["a"]=E.exports},b3e2:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("PolicyDetail",{attrs:{value:e.value,mode:e.mode,resource:e.resource}})},i=[],o=r("da25"),n=r("80db"),s={name:"ClusterAdmissionPolicy",props:{mode:{type:String,default:o["t"]},resource:{type:String,default:null},value:{type:Object,required:!0}},components:{PolicyDetail:n["a"]}},l=s,c=r("d802"),d=Object(c["a"])(l,a,i,!1,null,null,null);t["default"]=d.exports},b7b9:function(e,t,r){var a=r("5523");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=r("0ed3").default;i("5b3b0e05",a,!0,{sourceMap:!1,shadowMode:!1})},c714:function(e,t,r){var a=r("38eb");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=r("0ed3").default;i("ca468012",a,!0,{sourceMap:!1,shadowMode:!1})},cb8a:function(e,t,r){var a={"./kubewarden-dashboard-policy.json":["ec40",8],"./kubewarden-dashboard-policyserver.json":["82e7",9]};function i(e){if(!r.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],i=t[0];return r.e(t[1]).then((function(){return r.t(i,3)}))}i.keys=function(){return Object.keys(a)},i.id="cb8a",e.exports=i}}]);
//# sourceMappingURL=kubewarden-1.6.10.umd.min.detail.js.map